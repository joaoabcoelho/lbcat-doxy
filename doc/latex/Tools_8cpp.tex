\hypertarget{Tools_8cpp}{
\section{/home/eleclhcb/LHCb/lbcat-\/cmake/CatKernel/src/Tools.cpp File Reference}
\label{Tools_8cpp}\index{/home/eleclhcb/LHCb/lbcat-\/cmake/CatKernel/src/Tools.cpp@{/home/eleclhcb/LHCb/lbcat-\/cmake/CatKernel/src/Tools.cpp}}
}
{\ttfamily \#include $<$stdlib.h$>$}\par
{\ttfamily \#include $<$iostream$>$}\par
{\ttfamily \#include $<$string$>$}\par
{\ttfamily \#include $<$math.h$>$}\par
{\ttfamily \#include $<$unistd.h$>$}\par
{\ttfamily \#include \char`\"{}Application.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}Options.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}Tools.h\char`\"{}}\par
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{Tools_8cpp_a2c956caea957588eef9f0e6499e5e8c1}{setApplication} (\hyperlink{classApplication}{Application} $\ast$cat)
\item 
\hyperlink{classApplication}{Application} $\ast$ \hyperlink{Tools_8cpp_a27885a3c35afe79029fb830f32f66458}{application} ()
\item 
std::string \hyperlink{Tools_8cpp_a20f271409637c91b02c586644cb542e0}{itos} (int i)
\item 
std::string \hyperlink{Tools_8cpp_ad2603c89b82a1609399d9c9257f947f7}{ftos} (float f)
\item 
std::string \hyperlink{Tools_8cpp_ae8e9adcadc5cddf91fc3b7c58b41815d}{dtos} (double d)
\item 
std::string \hyperlink{Tools_8cpp_ac1d44f50965a8575cc7318dcbd3dce4d}{btos} (std::vector$<$ bool $>$ \hyperlink{Tools_8h_a16025e92b541c606122d8b4af59c2e76}{bits})
\item 
std::vector$<$ bool $>$ \hyperlink{Tools_8cpp_af5aab27b581d3099ed0afa100a1b16a1}{itob} (int val, int nbit)
\item 
int \hyperlink{Tools_8cpp_a784f38ec4c07dbcd5371f60fbfaa0531}{stoi} (std::string value)
\item 
double \hyperlink{Tools_8cpp_ae91b71f52ca53ead2aa47b7db006c404}{toDouble} (std::string s)
\item 
\hyperlink{classStatusCode}{StatusCode} \hyperlink{Tools_8cpp_a4bc84a478ae933b46eec04e253ed1614}{checkCmd} (std::string format, \hyperlink{Tools_8h_a3691191ee3160cd3594dce0138ef60fa}{commands} instruction, \hyperlink{var_8h_a2a1c35ad624b5ab1fedf9a5719b81b4e}{vars} \&varlist)
\item 
bool \hyperlink{Tools_8cpp_ae7615ca3a69f79ae0e70767043c49387}{isFloat} (const char $\ast$chain)
\item 
bool \hyperlink{Tools_8cpp_a9cfc57e458c74c6992c89e2f9312ea36}{isInt} (const char $\ast$chain)
\item 
bool \hyperlink{Tools_8cpp_afa8a5bb7c1f05c04e5b067d74b8472c7}{askSvc} (std::string msg)
\item 
bool \hyperlink{Tools_8cpp_a0c3fa1747044139af8fa1de8b921226c}{graphSvc} ()
\item 
std::string \hyperlink{Tools_8cpp_a0029683290056ff94e5ddc0dfaa3e1c4}{inputSvc} (std::string msg)
\item 
void \hyperlink{Tools_8cpp_afa4d2c71ecbefa3a07468d4a3d590e87}{wait} (int n)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classApplication}{Application} $\ast$ \hyperlink{Tools_8cpp_aea679c7117e896daafaf36140158c9ee}{gApp}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{Tools_8cpp_a27885a3c35afe79029fb830f32f66458}{
\index{Tools.cpp@{Tools.cpp}!application@{application}}
\index{application@{application}!Tools.cpp@{Tools.cpp}}
\subsubsection[{application}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Application}$\ast$ application ()}}
\label{Tools_8cpp_a27885a3c35afe79029fb830f32f66458}
return entry point for the application 

Definition at line 42 of file Tools.cpp.

Referenced by Application::bookkeeping(), checkCmd(), Computer::Computer(), CurrentMeasurement::execute(), ADCMeasurement::execute(), TestI2C::execute(), Acquisition::execute(), DLL::init(), CurrentMeasurement::initialize(), ADCMeasurement::initialize(), Acquisition::initialize(), isInt(), Application::loadHistoryFile(), MsgSvc::log(), MsgSvc::msgSvc(), Application::network(), NI6008::NI6008(), DLL::print(), ProcDataBase::ProcDataBase(), Server::start(), wait(), and Computer::$\sim$Computer().


\begin{DoxyCode}
42                            {
43   return gApp;
44 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_afa8a5bb7c1f05c04e5b067d74b8472c7}{
\index{Tools.cpp@{Tools.cpp}!askSvc@{askSvc}}
\index{askSvc@{askSvc}!Tools.cpp@{Tools.cpp}}
\subsubsection[{askSvc}]{\setlength{\rightskip}{0pt plus 5cm}bool askSvc (std::string {\em msg})}}
\label{Tools_8cpp_afa8a5bb7c1f05c04e5b067d74b8472c7}


Definition at line 242 of file Tools.cpp.


\begin{DoxyCode}
242                              {
243   /*
244   AskPrinter asker = application() -> options() -> askPrinter ();
245   return asker ( msg);
246   */
247   return false;
248 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_ac1d44f50965a8575cc7318dcbd3dce4d}{
\index{Tools.cpp@{Tools.cpp}!btos@{btos}}
\index{btos@{btos}!Tools.cpp@{Tools.cpp}}
\subsubsection[{btos}]{\setlength{\rightskip}{0pt plus 5cm}std::string btos (std::vector$<$ bool $>$)}}
\label{Tools_8cpp_ac1d44f50965a8575cc7318dcbd3dce4d}
Conversion from binary (std::vector$<$std::string$>$) to std::string 

Definition at line 67 of file Tools.cpp.

References itos().

Referenced by IOdata::dump().


\begin{DoxyCode}
67                                     {   
68   int i=bits.size()-1;
69   std::string output;
70   while(i>=0){
71     output+=itos(bits[i]);
72     i--;
73   } 
74   return output;
75 }   
\end{DoxyCode}
\hypertarget{Tools_8cpp_a4bc84a478ae933b46eec04e253ed1614}{
\index{Tools.cpp@{Tools.cpp}!checkCmd@{checkCmd}}
\index{checkCmd@{checkCmd}!Tools.cpp@{Tools.cpp}}
\subsubsection[{checkCmd}]{\setlength{\rightskip}{0pt plus 5cm}{\bf StatusCode} checkCmd (std::string, \/  {\bf commands}, \/  {\bf vars} \&)}}
\label{Tools_8cpp_a4bc84a478ae933b46eec04e253ed1614}
check the format of an instruction 

Definition at line 126 of file Tools.cpp.

References application(), StatusCode::FAILURE, images::index, Object::info(), isFloat(), isInt(), cat::size, StatusCode::SUCCESS, and Object::warning().


\begin{DoxyCode}
126                                                                               {
127   int size = instruction.size();
128   if ( size<=0 ){
129     return StatusCode::FAILURE;
130   }
131 
132   // line is empty
133   if ( format.empty() ||  std::string::npos==format.find_first_not_of(' ') ) {
134     return StatusCode::FAILURE;
135   }
136 
137   // split the format in a vector of strings 
138   // decode the main command
139   std::string line = std::string (format, 
140                   format.find_first_not_of(' ') , 
141                   format.size());
142   std::vector<std::string> cmd;
143   std::string separator(1,' ');
144   unsigned int ipos = line.find( separator );
145   cmd.push_back ( std::string( line, 0, ipos ) );
146   if ( 0!=std::string ( line , 0 , ipos ).compare(instruction[0]) ){
147     application()->info(std::string ( line , 0 , ipos )+" "+instruction[0],"");
148     return StatusCode::FAILURE;
149   }
150 
151   unsigned int pos ;
152 
153   std::string str = line;
154   while ( ipos!=std::string::npos ){
155     std::string tmp = std::string (str, ipos , str.size());
156     str = tmp;
157     pos=str.find_first_not_of( ' ' );    
158     if ( pos == std::string::npos ) {      
159       break;
160     }
161     std::string arg;
162     ipos = str.find(separator,pos);
163   
164     if (ipos==std::string::npos){
165       arg =  std::string(str , pos );
166     }
167     else {
168       arg = std::string(str , pos, ipos - 1);
169     }
170     cmd.push_back(arg);
171   }
172 
173   // check parameter number
174   if ( instruction.size() != cmd.size() ){
175     application()->info("wrong number of parameter. a enelver !!!!","");
176     return StatusCode::FAILURE;
177   }
178   // no parameter
179   if ( 1==cmd.size() ){
180     return StatusCode::SUCCESS;
181   }
182   // decode the format
183   for (unsigned int index = 1; index < cmd.size() ; ++index){
184     // int ?
185     if ( 0==cmd[index].compare("%i") || 0==cmd[index].compare("%I") ){
186       if ( !isInt ( instruction[index].c_str() ) ) {
187     application()->warning("We expect an integer parameter ["+instruction[index]+
      "]","checkCmd");
188     return StatusCode::FAILURE;
189       }
190       varlist.push_back ( var( atoi(instruction[index].c_str()) ) );
191     }
192     // float ?
193     if ( 0==cmd[index].compare("%f") || 0==cmd[index].compare("%F") ){
194       if ( !isFloat ( instruction[index].c_str() ) ) {
195     application()->warning("We expect a float parameter ["+instruction[index]+"]"
      ,"checkCmd");
196     return StatusCode::FAILURE;
197       }
198       varlist.push_back( var ( atof(instruction[index].c_str()) ) );
199     }
200   }
201   return StatusCode::SUCCESS;
202 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_ae8e9adcadc5cddf91fc3b7c58b41815d}{
\index{Tools.cpp@{Tools.cpp}!dtos@{dtos}}
\index{dtos@{dtos}!Tools.cpp@{Tools.cpp}}
\subsubsection[{dtos}]{\setlength{\rightskip}{0pt plus 5cm}std::string dtos (double {\em d})}}
\label{Tools_8cpp_ae8e9adcadc5cddf91fc3b7c58b41815d}


Definition at line 60 of file Tools.cpp.


\begin{DoxyCode}
60                         {   
61   char val[20];
62   sprintf(val,"%f",d);
63   std::string str(val);
64   return str;
65 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_ad2603c89b82a1609399d9c9257f947f7}{
\index{Tools.cpp@{Tools.cpp}!ftos@{ftos}}
\index{ftos@{ftos}!Tools.cpp@{Tools.cpp}}
\subsubsection[{ftos}]{\setlength{\rightskip}{0pt plus 5cm}std::string ftos (float)}}
\label{Tools_8cpp_ad2603c89b82a1609399d9c9257f947f7}
Conversion from float to std::string 

Definition at line 53 of file Tools.cpp.


\begin{DoxyCode}
53                        {    
54   char val[20];
55   sprintf(val,"%f",f);
56   std::string str(val);
57   return str;
58 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_a0c3fa1747044139af8fa1de8b921226c}{
\index{Tools.cpp@{Tools.cpp}!graphSvc@{graphSvc}}
\index{graphSvc@{graphSvc}!Tools.cpp@{Tools.cpp}}
\subsubsection[{graphSvc}]{\setlength{\rightskip}{0pt plus 5cm}bool graphSvc ()}}
\label{Tools_8cpp_a0c3fa1747044139af8fa1de8b921226c}


Definition at line 250 of file Tools.cpp.


\begin{DoxyCode}
250                 {
251   //  GraphPrinter graph = application() -> options() -> graphPrinter ();
252   //  return graph ( );
253   return false;
254 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_a0029683290056ff94e5ddc0dfaa3e1c4}{
\index{Tools.cpp@{Tools.cpp}!inputSvc@{inputSvc}}
\index{inputSvc@{inputSvc}!Tools.cpp@{Tools.cpp}}
\subsubsection[{inputSvc}]{\setlength{\rightskip}{0pt plus 5cm}std::string inputSvc (std::string {\em msg})}}
\label{Tools_8cpp_a0029683290056ff94e5ddc0dfaa3e1c4}


Definition at line 259 of file Tools.cpp.


\begin{DoxyCode}
259                                     {
260   /*
261   InputSvc inp = application() -> options() -> inputSvc ();
262   return inp ( msg );
263   */
264   return std::string("not implemented.");
265 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_ae7615ca3a69f79ae0e70767043c49387}{
\index{Tools.cpp@{Tools.cpp}!isFloat@{isFloat}}
\index{isFloat@{isFloat}!Tools.cpp@{Tools.cpp}}
\subsubsection[{isFloat}]{\setlength{\rightskip}{0pt plus 5cm}bool isFloat (const char $\ast$)}}
\label{Tools_8cpp_ae7615ca3a69f79ae0e70767043c49387}
check if string is compatible with float 

Definition at line 206 of file Tools.cpp.

Referenced by checkCmd().


\begin{DoxyCode}
206                                   {
207   const char *pChain = chain;
208   while (*pChain!='\0') {
209     if ( *pChain!='0' && *pChain!='1' && *pChain!='2' && *pChain!='3' &&
210      *pChain!='4' && *pChain!='5' && *pChain!='6' && *pChain!='7' &&
211      *pChain!='8' && *pChain!='9' && *pChain!='+' && *pChain!='-' &&
212      *pChain!='.' ){
213       return false;
214     }
215     pChain++;
216   }
217   return true;
218 } 
\end{DoxyCode}
\hypertarget{Tools_8cpp_a9cfc57e458c74c6992c89e2f9312ea36}{
\index{Tools.cpp@{Tools.cpp}!isInt@{isInt}}
\index{isInt@{isInt}!Tools.cpp@{Tools.cpp}}
\subsubsection[{isInt}]{\setlength{\rightskip}{0pt plus 5cm}bool isInt (const char $\ast$)}}
\label{Tools_8cpp_a9cfc57e458c74c6992c89e2f9312ea36}
check if string is compatible with int 

Definition at line 223 of file Tools.cpp.

References application(), and Object::info().

Referenced by checkCmd().


\begin{DoxyCode}
223                                 {
224   const char *pChain = chain;  
225   bool first = true;
226   while (*pChain!='\0') {
227     if ( ( *pChain<'0' || *pChain>'9' ) ){
228       application()->info(chain,"");
229       if ( !first || *pChain!='-' ){ 
230     return false;
231       }
232     }
233     first = false;
234     pChain++;
235   }
236   return true;
237 } 
\end{DoxyCode}
\hypertarget{Tools_8cpp_af5aab27b581d3099ed0afa100a1b16a1}{
\index{Tools.cpp@{Tools.cpp}!itob@{itob}}
\index{itob@{itob}!Tools.cpp@{Tools.cpp}}
\subsubsection[{itob}]{\setlength{\rightskip}{0pt plus 5cm}std::vector$<$bool$>$ itob (int, \/  int)}}
\label{Tools_8cpp_af5aab27b581d3099ed0afa100a1b16a1}
Conversion from integer to binary (std::string) 

Definition at line 77 of file Tools.cpp.

Referenced by IOdata::dump().


\begin{DoxyCode}
77                                       {
78   int i=nbit-1; 
79   int power; 
80   std::vector<bool> bits(nbit);
81   //    int limit=1<<(nbit-1);
82   //int vsat=(val<limit)?val:int(limit-1); //saturation
83   int vsat=val;
84   while(i>=0){
85     power=1<<i;
86     bits[i]=(vsat/power==1);
87     vsat=vsat%power;
88     i--;
89   }
90   return bits;
91 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_a20f271409637c91b02c586644cb542e0}{
\index{Tools.cpp@{Tools.cpp}!itos@{itos}}
\index{itos@{itos}!Tools.cpp@{Tools.cpp}}
\subsubsection[{itos}]{\setlength{\rightskip}{0pt plus 5cm}std::string itos (int)}}
\label{Tools_8cpp_a20f271409637c91b02c586644cb542e0}
Conversion from int (long) to std::string 

Definition at line 46 of file Tools.cpp.


\begin{DoxyCode}
46                      {  
47   char val[20];
48   sprintf(val,"%d",i);
49   std::string str(val);
50   return str;
51 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_a2c956caea957588eef9f0e6499e5e8c1}{
\index{Tools.cpp@{Tools.cpp}!setApplication@{setApplication}}
\index{setApplication@{setApplication}!Tools.cpp@{Tools.cpp}}
\subsubsection[{setApplication}]{\setlength{\rightskip}{0pt plus 5cm}void setApplication ({\bf Application} $\ast$)}}
\label{Tools_8cpp_a2c956caea957588eef9f0e6499e5e8c1}
Define entry point for the application 

Definition at line 38 of file Tools.cpp.

Referenced by Application::Application().


\begin{DoxyCode}
38                                       {
39   gApp = cat;  
40 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_a784f38ec4c07dbcd5371f60fbfaa0531}{
\index{Tools.cpp@{Tools.cpp}!stoi@{stoi}}
\index{stoi@{stoi}!Tools.cpp@{Tools.cpp}}
\subsubsection[{stoi}]{\setlength{\rightskip}{0pt plus 5cm}int stoi (std::string)}}
\label{Tools_8cpp_a784f38ec4c07dbcd5371f60fbfaa0531}
Conversion from binary (std::string) to integer 

Definition at line 93 of file Tools.cpp.

References cat::size.


\begin{DoxyCode}
93                          {  
94   const unsigned int codage=2;
95   int result=0;
96   char h[codage]={'0','1'};
97   const unsigned int size=value.size();
98   const char* word=value.c_str();
99   unsigned int pos=0;
100   while (pos<size){
101     bool isSeen=false;
102     for (unsigned int j=0; j<codage && !isSeen; j++){
103       if (h[j]==word[pos]){
104     result+=int(j*pow(2.,(int)(size-pos-1)));
105     isSeen=true;
106       }
107     }
108     pos++;
109   }
110   return result;
111 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_ae91b71f52ca53ead2aa47b7db006c404}{
\index{Tools.cpp@{Tools.cpp}!toDouble@{toDouble}}
\index{toDouble@{toDouble}!Tools.cpp@{Tools.cpp}}
\subsubsection[{toDouble}]{\setlength{\rightskip}{0pt plus 5cm}double toDouble (std::string)}}
\label{Tools_8cpp_ae91b71f52ca53ead2aa47b7db006c404}
Conversion from string (potentially with a comma) to a double 

Definition at line 113 of file Tools.cpp.


\begin{DoxyCode}
113                             {
114     // do not use a reference, since we're going to modify this string
115     // If you do not care about ',' or '.' in your string use a 
116     // reference instead.
117     size_t found = s.find(",");
118     if(found != std::string::npos)
119         s[found]='.'; // Change ',' to '.'
120     return atof(s.c_str());
121 }
\end{DoxyCode}
\hypertarget{Tools_8cpp_afa4d2c71ecbefa3a07468d4a3d590e87}{
\index{Tools.cpp@{Tools.cpp}!wait@{wait}}
\index{wait@{wait}!Tools.cpp@{Tools.cpp}}
\subsubsection[{wait}]{\setlength{\rightskip}{0pt plus 5cm}void wait (int {\em nbr\_\-ms})}}
\label{Tools_8cpp_afa4d2c71ecbefa3a07468d4a3d590e87}
system wait for a few seconds 

Definition at line 271 of file Tools.cpp.

References application(), itos(), and Object::verbose().

Referenced by CurrentMeasurement::execute(), ADCMeasurement::execute(), UsbFTMLInterface::init(), and UsbFTInterface::init().


\begin{DoxyCode}
272 {
273   application()->verbose("wait for "+itos(n)+" ms.","Tools::wait");
274 #ifdef WIN32
275   Sleep( n );
276 #else
277   usleep( 1000 * n );
278 #endif
279 }
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{Tools_8cpp_aea679c7117e896daafaf36140158c9ee}{
\index{Tools.cpp@{Tools.cpp}!gApp@{gApp}}
\index{gApp@{gApp}!Tools.cpp@{Tools.cpp}}
\subsubsection[{gApp}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Application}$\ast$ {\bf gApp}}}
\label{Tools_8cpp_aea679c7117e896daafaf36140158c9ee}


Definition at line 36 of file Tools.cpp.